<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å‡±ç‡•ä¸å‹•ç”¢</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TG3GW6YQSK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-TG3GW6YQSK');
  </script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <style>
    body { font-family: "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif; margin: 30px; }
    label { display: block; margin: 8px 0 2px; }
    input[type="text"], select, textarea { box-sizing: border-box; font-size: 16px; }
    /* ...ä½ çš„CSSå…¨éƒ¨ç…§è²¼... */
    /* é€™è£¡çœç•¥ï¼Œè«‹ç”¨ä½ åŸæœ¬çš„CSS */
  </style>
</head>
<body>
  <!-- å¯†ç¢¼ç™»å…¥å€å¡Š -->
  <div id="pwbox">
    <h2>å‡±ç‡•ä¸å‹•ç”¢</h2>
    <input type="password" id="pwinput" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
    <button id="pwbtn" onclick="checkPW()">é€²å…¥</button>
    <div id="pwmsg"></div>
    <hr style="margin:24px 0;">
    <button id="lineLoginBtn" style="font-size:18px;background:#06c755;color:#fff;padding:10px 24px;border:none;border-radius:6px;cursor:pointer;">
      ç”¨ LINE ç™»å…¥
    </button>
  </div>
  <!-- è¡¨å–®å…§å®¹å€å¡Šï¼Œé è¨­éš±è— -->
  <div id="maincontent" style="display:none;">
    <h2>æˆ¿å±‹è³‡è¨Šè‡ªå‹•ç”Ÿæˆå™¨</h2>
    <form id="houseForm" autocomplete="off">
      <!-- æ—¥æœŸ + ä»Šæ—¥ç‰©ä»¶ -->
      <div class="row" style="flex-wrap: nowrap; overflow-x: auto;">
        <label style="min-width:40px;margin-right:4px;flex-shrink:0;">æ—¥æœŸ</label>
        <input name="date" id="date" style="width:100px;margin-right:8px;flex-shrink:0;" readonly>
        <label style="margin-right:4px;flex-shrink:0;">ä»Šæ—¥ç‰©ä»¶</label>
        <input name="today_obj" id="today_obj" placeholder="å¯å¡«å¯«" style="width:120px;max-width:none;flex-shrink:1;min-width:80px;">
      </div>
      <!-- å¯å¦å»£å‘Š -->
      <div class="row">
        <label>å¯å¦å»£å‘Šï¼š</label>
        <div class="inline-options">
          <label><input type="radio" name="ad" value="å¯åˆŠç™»">å¯åˆŠç™»</label>
          <label><input type="radio" name="ad" value="ä¸å¯åˆŠç™»591å¯åˆŠç™»å…¶ä»–å¹³å°">ä¸å¯åˆŠç™»591å¯åˆŠç™»å…¶ä»–å¹³å°</label>
          <label><input type="radio" name="ad" value="ä¸å¯åˆŠç™»">ä¸å¯åˆŠç™»</label>
        </div>
      </div>
      <!-- å¯å¦ç°½å§”æ‰˜æ›¸ -->
      <div class="row">
        <label>å¯å¦ç°½å§”æ‰˜æ›¸ï¼š</label>
        <div class="inline-options">
          <label><input type="radio" name="sign" value="å¯(å·²ç°½)">å¯(å·²ç°½)</label>
          <label><input type="radio" name="sign" value="å¯(å¯è£œç°½)">å¯(å¯è£œç°½)</label>
          <label><input type="radio" name="sign" value="ä¸å¯(å¯ä¸Šæ¶å»£å‘Š)">ä¸å¯(å¯ä¸Šæ¶å»£å‘Š)</label>
          <label><input type="radio" name="sign" value="ä¸å¯">ä¸å¯</label>
        </div>
      </div>
      <!-- åœ°å€ -->
      <label>åœ°å€ï¼š<input name="address" class="auto-grow" required></label>
      <!-- é ‚åŠ æ˜¯å¦ç‚ºæ°‘åœ‹84å¹´å‰å¢å»º -->
      <label>é ‚åŠ æ˜¯å¦ç‚ºæ°‘åœ‹84å¹´å‰å¢å»ºï¼š
        <input type="radio" name="top" value="æ˜¯">æ˜¯
        <input type="radio" name="top" value="å¦">å¦
      </label>
      <!-- æˆ¿è™Ÿ -->
      <label>æˆ¿è™Ÿï¼š<input name="room" class="auto-grow">
        <input type="radio" name="room_none" value="ç„¡">ç„¡
      </label>
      <!-- ç¸½æ¨“å±¤ -->
      <label>ç¸½æ¨“å±¤ï¼š<input name="floor" class="auto-grow" required></label>
      <!-- å»ºç‰©å‹æ…‹ -->
      <label>å»ºç‰©å‹æ…‹ï¼š<input name="type" class="auto-grow" required></label>
      <!-- åªæ•¸ -->
      <label>åªæ•¸ï¼š<input name="area" class="auto-grow" required></label>
      <!-- è¬„æœ¬æª¢æ ¸å€å¡Š -->
      <div class="ocr-section">
        <div class="ocr-title">ğŸ“· è¬„æœ¬è³‡è¨Šæ™ºèƒ½æª¢æ ¸</div>
        <div class="ocr-subtitle">è‡ªå‹•æª¢æ ¸ï¼šåœ°å€ã€æ¨“å±¤ã€åªæ•¸</div>
        <input type="file" id="deedImg" accept="image/*">
        <button type="button" onclick="ocrAndCompare()" style="font-size:14px;">è¾¨è­˜ä¸¦æ¯”å°</button>
        <div id="ocrResult"></div>
      </div>
      <!-- æ ¼å±€ -->
      <label style="font-size: 14px;">
        æ ¼å±€ï¼š
        <input type="text" name="layout_room" class="small-input" maxlength="2" placeholder="æˆ¿"> <span style="font-size: 12px;">æˆ¿</span>
        <input type="text" name="layout_living" class="small-input" maxlength="2" placeholder="å»³"> <span style="font-size: 12px;">å»³</span>
        <input type="text" name="layout_bath" class="small-input" maxlength="2" placeholder="è¡›æµ´"> <span style="font-size: 12px;">è¡›æµ´</span>
        <input type="text" name="layout_kitchen" class="small-input" maxlength="2" placeholder="å»šæˆ¿"> <span style="font-size: 12px;">å»šæˆ¿</span>
        <input type="text" name="layout_balcony" class="small-input" maxlength="2" placeholder="é™½å°"> <span style="font-size: 12px;">é™½å°</span>
        <label style="font-size: 12px;"><input type="checkbox" name="layout_option" value="é–‹æ”¾å¼">é–‹æ”¾å¼</label>
        <label style="font-size: 12px;"><input type="checkbox" name="layout_option" value="æ¨“ä¸­æ¨“">æ¨“ä¸­æ¨“</label>
      </label>
      <label>ç§Ÿé‡‘ï¼š<input name="rent" class="auto-grow" required></label>
      <label>ç®¡ç†è²»ï¼š<input name="fee" class="auto-grow" required>
        <input type="radio" name="fee_none" value="ç„¡">ç„¡
      </label>
      <label>åº•åƒ¹ï¼š<input name="base" class="auto-grow" required></label>
      <!-- å ±ç¨…ã€ç§Ÿè£œã€å…¥ç±ã€å¯µç‰©ã€åƒåœ¾ä»£æ”¶ã€åœè»Šä½ -->
      <div class="row">
        <label>å ±ç¨…ï¼š</label>
        <div class="inline-options">
          <label><input type="radio" name="tax" value="å¯">å¯</label>
          <label><input type="radio" name="tax" value="å¦">å¦</label>
          <label><input type="radio" name="tax" value="å…¶ä»–">å…¶ä»–</label>
        </div>
      </div>
      <div class="row">
        <label>ç§Ÿè£œï¼š</label>
        <div class="inline-options">
          <label><input type="radio" name="subsidy" value="å¯">å¯</label>
          <label><input type="radio" name="subsidy" value="å¦">å¦</label>
          <label><input type="radio" name="subsidy" value="å…¶ä»–">å…¶ä»–</label>
        </div>
      </div>
      <div class="row">
        <label>å…¥ç±ï¼š</label>
        <div class="inline-options">
          <label><input type="radio" name="register" value="å¯">å¯</label>
          <label><input type="radio" name="register" value="å¦">å¦</label>
          <label><input type="radio" name="register" value="å…¶ä»–">å…¶ä»–</label>
        </div>
      </div>
      <!-- å¯µç‰©æ¬„ä½ -->
      <div class="row">
        <label>å¯µç‰©ï¼š</label>
        <div class="inline-options">
          <label><input type="radio" name="pet" value="ä¸å¯">ä¸å¯</label>
          <label><input type="radio" name="pet" value="å¯å¯µ">å¯å¯µ</label>
          <label><input type="radio" name="pet" value="å¯å¯µ(å¯è«‡)">å¯å¯µ(å¯è«‡)</label>
          <label><input type="radio" name="pet" value="å¯è²“">å¯è²“</label>
          <label><input type="radio" name="pet" value="å¯ç‹—">å¯ç‹—</label>
        </div>
      </div>
      <!-- åƒåœ¾ä»£æ”¶æ¬„ä½ -->
      <div class="row">
        <label>åƒåœ¾ä»£æ”¶ï¼š</label>
        <div class="inline-options">
          <label>
            <input type="radio" name="garbage" value="æœ‰" onclick="toggleGarbageNote(this)">
            æœ‰
            <input type="text" id="garbage_note" name="garbage_note" class="auto-grow" style="display:none;vertical-align:middle;" placeholder="å‚™è¨»">
          </label>
          <label><input type="radio" name="garbage" value="ç„¡" onclick="toggleGarbageNote(this)">ç„¡</label>
          <label><input type="radio" name="garbage" value="å…¶ä»–" onclick="toggleGarbageNote(this)">å…¶ä»–</label>
        </div>
      </div>
      <!-- åœè»Šä½æ¬„ä½ -->
      <div class="row">
        <label>åœè»Šä½ï¼š</label>
        <div class="inline-options">
          <label>
            <input type="radio" name="parking" value="æœ‰" onclick="toggleParkingNote(this)">
            æœ‰
            <input type="text" id="parking_note" name="parking_note" class="auto-grow" style="display:none;vertical-align:middle;" placeholder="å‚™è¨»">
          </label>
          <label><input type="radio" name="parking" value="ç„¡" onclick="toggleParkingNote(this)">ç„¡</label>
          <label><input type="radio" name="parking" value="å…¶ä»–" onclick="toggleParkingNote(this)">å…¶ä»–</label>
        </div>
      </div>
      <label>å…¬è¨­ï¼š<input name="public" class="auto-grow" placeholder="è«‹å¡«å¯«å…¬è¨­å…§å®¹"></label>
      <label>é›»è²»$/åº¦ï¼š<input name="electric" class="auto-grow" required></label>
      <label>æ°´è²»ï¼š<input name="water" class="auto-grow" required></label>
      <label>ç“¦æ–¯ï¼š<input name="gas" class="auto-grow" required></label>
      <label>é„°è¿‘äº¤é€š(ç«™é»/åˆ†é˜)ï¼š<input name="traffic" class="auto-grow" required></label>
      <label>å¸¶çœ‹æ–¹å¼ï¼š<input name="show" class="auto-grow" required></label>
      <label>é™„åŠ è¨­å‚™ï¼š<textarea name="equip" class="square-textarea" required></textarea></label>
      <label>æ³¨æ„äº‹é …(ç”Ÿæ´»æ©Ÿèƒ½ã€æ±æœç­‰è£œå……)ï¼š<textarea name="note" class="square-textarea" required></textarea></label>
      <label>é–‹ç™¼ï¼š<input name="dev" class="auto-grow" required></label>
      <button type="button" onclick="generate()">ç”¢ç”Ÿæ ¼å¼</button>
      <button type="button" onclick="copyText()">è¤‡è£½å…§å®¹</button>
    </form>
    <textarea id="output" readonly placeholder="é€™è£¡æœƒè‡ªå‹•ç”¢ç”Ÿæ ¼å¼å…§å®¹" oninput="autoGrow(this)"></textarea>
  </div>
  <script>
    // å¯†ç¢¼é©—è­‰
    function checkPW() {
      var pw = document.getElementById('pwinput').value;
      if(pw === '3131') {
        document.getElementById('pwbox').style.display = 'none';
        document.getElementById('maincontent').style.display = '';
        setTimeout(function(){
          var firstInput = document.querySelector('#maincontent input, #maincontent textarea');
          if(firstInput) firstInput.focus();
        }, 100);
      } else {
        document.getElementById('pwmsg').innerText = 'å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡';
      }
    }
    document.getElementById('pwinput').addEventListener('keydown', function(e){
      if(e.key === 'Enter') checkPW();
    });
    window.onload = function() {
      document.getElementById('maincontent').style.display = 'none';
    }
  </script>
  <script>
    // OCRæ¯”å°åŠŸèƒ½
    function toChineseNumber(n) {
      const map = ['é›¶','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'];
      if (n === 100) return 'ä¸€ç™¾';
      if (n === 10) return 'å';
      if (n < 10) return map[n];
      if (n < 20) return 'å' + map[n % 10];
      if (n < 100) {
        return map[Math.floor(n/10)] + 'å' + (n%10 === 0 ? '' : map[n%10]);
      }
      return n;
    }
    function numToChinese(str) {
      return str.replace(/([0-9]{1,3})æ¨“/g, function(match, p1) {
        return toChineseNumber(parseInt(p1)) + 'æ¨“';
      });
    }
    function chineseNumberToNum(ch) {
      const map = {'é›¶':0,'ä¸€':1,'äºŒ':2,'ä¸‰':3,'å››':4,'äº”':5,'å…­':6,'ä¸ƒ':7,'å…«':8,'ä¹':9};
      if (ch === 'å') return 10;
      if (ch === 'ä¸€ç™¾') return 100;
      if (ch.length === 2 && ch[0] === 'å') return 10 + map[ch[1]];
      if (ch.length === 2 && ch[1] === 'å') return map[ch[0]] * 10;
      if (ch.length === 3 && ch[1] === 'å') return map[ch[0]] * 10 + map[ch[2]];
      return map[ch] || ch;
    }
    function chineseToNum(str) {
      return str.replace(/([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾]+)æ¨“/g, function(match, p1) {
        return chineseNumberToNum(p1) + 'æ¨“';
      });
    }
    function normalizeAddress(str) {
      return str.replace(/[\s,ï¼Œã€‚ï¼ã€:ï¼š\-â€”_()ï¼ˆï¼‰]/g, '')
                .replace(/[ï¼-ï¼™]/g, d => String.fromCharCode(d.charCodeAt(0) - 65248));
    }
    function addressMatch(formAddr, deedAddr) {
      const f = normalizeAddress(formAddr);
      const d = normalizeAddress(deedAddr);
      const fNumToChinese = numToChinese(f);
      const dNumToChinese = numToChinese(d);
      const fChineseToNum = chineseToNum(f);
      const dChineseToNum = chineseToNum(d);

      return (
        f.endsWith(d) ||
        fNumToChinese.endsWith(d) ||
        f.endsWith(dNumToChinese) ||
        fChineseToNum.endsWith(d) ||
        f.endsWith(dChineseToNum) ||
        fNumToChinese.endsWith(dNumToChinese) ||
        fChineseToNum.endsWith(dChineseToNum)
      );
    }
    async function ocrAndCompare() {
      const file = document.getElementById('deedImg').files[0];
      if (!file) return alert('è«‹å…ˆä¸Šå‚³ç…§ç‰‡');
      const address = document.querySelector('input[name="address"]').value.trim();
      const floorInput = document.querySelector('input[name="floor"]').value.trim();
      const area = document.querySelector('input[name="area"]').value.trim();
      if (!address || !floorInput || !area) {
        alert('è«‹å…ˆå¡«å¯«åœ°å€ã€ç¸½æ¨“å±¤ã€åªæ•¸å†ä¸Šå‚³è¬„æœ¬æ¯”å°');
        return;
      }
      document.getElementById('ocrResult').innerText = 'è¾¨è­˜ä¸­...';
      const { data: { text } } = await Tesseract.recognize(file, 'chi_tra');
      document.getElementById('ocrResult').innerText = text;

      let deedAddress = '';
      let deedFloor = '';
      let deedLevel = '';
      let deedArea = '';
      text.split('\n').forEach(line => {
        const lineNoSpace = line.replace(/\s/g,'');
        if (!deedAddress && lineNoSpace.includes('å»ºç‰©é–€ç‰Œ')) {
          deedAddress = lineNoSpace.replace(/å»ºç‰©é–€ç‰Œ[:ï¼š]?/, '').trim();
        }
        if (!deedFloor && lineNoSpace.match(/å±¤.*æ•¸/)) {
          const match = lineNoSpace.match(/å±¤.*æ•¸[:ï¼š]?0*([0-9ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾]+)å±¤?/);
          deedFloor = match ? match[1].replace('å±¤','').replace(/^0+/, '').trim() : '';
          deedFloor = chineseNumberToNum(deedFloor) + '';
        }
        if (!deedLevel && lineNoSpace.match(/å±¤.*æ¬¡/)) {
          const match = lineNoSpace.match(/å±¤.*æ¬¡[:ï¼š]?([0-9ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾]+)å±¤?/);
          deedLevel = match ? match[1].replace('å±¤','').trim() : '';
          deedLevel = chineseNumberToNum(deedLevel) + '';
        }
        if (!deedArea && lineNoSpace.match(/ç¸½åªæ•¸/)) {
          const match = lineNoSpace.match(/ç¸½åªæ•¸[:ï¼š]?([\d.]+)/);
          deedArea = match ? match[1] : '';
        }
      });

      let [inputLevel, inputFloor] = floorInput.split('/');
      inputLevel = inputLevel ? inputLevel.replace('å±¤', '').replace(/^0+/, '').trim() : '';
      inputFloor = inputFloor ? inputFloor.replace('å±¤', '').replace(/^0+/, '').trim() : '';
      inputLevel = chineseNumberToNum(inputLevel) + '';
      inputFloor = chineseNumberToNum(inputFloor) + '';

      if (!deedAddress || !deedFloor || !deedLevel || !deedArea) {
        alert('è¬„æœ¬è³‡è¨Šç„¡æ³•è¾¨è­˜ï¼Œè«‹ç¢ºèªç…§ç‰‡æ¸…æ™°ä¸”æ ¼å¼æ­£ç¢º\n\n---\nOCRåŸå§‹æ–‡å­—å¦‚ä¸‹ï¼š\n' + document.getElementById('ocrResult').innerText);
        return;
      }

      let msg = '';
      if (!addressMatch(address, deedAddress)) {
        msg += `åœ°å€èˆ‡è¬„æœ¬ä¸ç¬¦\nï¼ˆè¡¨å–®ï¼š${address}ï¼Œè¬„æœ¬å»ºç‰©é–€ç‰Œï¼š${deedAddress}ï¼‰\n`;
      }
      if (inputFloor !== deedFloor) {
        msg += `ç¸½æ¨“å±¤èˆ‡è¬„æœ¬ä¸ç¬¦\nï¼ˆè¡¨å–®ï¼š${inputFloor}ï¼Œè¬„æœ¬å±¤æ•¸ï¼š${deedFloor}ï¼‰\n`;
      }
      if (inputLevel !== deedLevel) {
        msg += `æ‰€åœ¨æ¨“å±¤èˆ‡è¬„æœ¬ä¸ç¬¦\nï¼ˆè¡¨å–®ï¼š${inputLevel}ï¼Œè¬„æœ¬å±¤æ¬¡ï¼š${deedLevel}ï¼‰\n`;
      }
      if (area && deedArea && parseFloat(area) !== parseFloat(deedArea)) {
        msg += `åªæ•¸èˆ‡è¬„æœ¬ä¸ç¬¦\nï¼ˆè¡¨å–®ï¼š${area}ï¼Œè¬„æœ¬ç¸½åªæ•¸ï¼š${deedArea}ï¼‰\n`;
      }

      if (msg) alert(msg);
      else alert('è¬„æœ¬è³‡è¨Šèˆ‡å¡«å¯«å…§å®¹ä¸€è‡´');
    }

    function autoGrow(element) {
      element.style.height = "5px";
      element.style.height = (element.scrollHeight) + "px";
    }

    function getLayoutValue() {
      const items = [];
      const room = document.querySelector('input[name="layout_room"]').value;
      const living = document.querySelector('input[name="layout_living"]').value;
      const bath = document.querySelector('input[name="layout_bath"]').value;
      const kitchen = document.querySelector('input[name="layout_kitchen"]').value;
      const balcony = document.querySelector('input[name="layout_balcony"]').value;
      if (room) items.push(`${room}æˆ¿`);
      if (living) items.push(`${living}å»³`);
      if (bath) items.push(`${bath}è¡›æµ´`);
      if (kitchen) items.push(`${kitchen}å»šæˆ¿`);
      if (balcony) items.push(`${balcony}é™½å°`);
      let options = [];
      document.querySelectorAll('input[name="layout_option"]:checked').forEach(function(cb) {
        options.push(cb.value);
      });
      if (options.length) items.push(options.join('ã€'));
      return items.join('');
    }

    function generate() {
      const data = new FormData(document.getElementById('houseForm'));
      let output =
        `${data.get('date')} ä»Šæ—¥ç‰©ä»¶${data.get('today_obj') ? ' ' + data.get('today_obj') : ''}\næ¥­å‹™ä»£ç§Ÿé€²ä»¶æ ¼å¼å¦‚ä¸‹\n` +
        `å¯å¦å»£å‘Šï¼š${data.get('ad') || ''}\n` +
        `å¯å¦ç°½å§”æ‰˜æ›¸ï¼š${data.get('sign') || ''}\n` +
        `åœ°å€ï¼š${data.get('address') || ''}\n` +
        `é ‚åŠ æ˜¯å¦ç‚ºæ°‘åœ‹84å¹´å‰å¢å»ºï¼š${data.get('top') || ''}\n` +
        `æˆ¿è™Ÿï¼š${data.get('room') || ''}${data.get('room_none') ? 'ï¼ˆç„¡ï¼‰' : ''}\n` +
        `ç¸½æ¨“å±¤ï¼š${data.get('floor') || ''}\n` +
        `å»ºç‰©å‹æ…‹ï¼š${data.get('type') || ''}\n` +
        `åªæ•¸ï¼š${data.get('area') || ''}\n` +
        `æ ¼å±€ï¼š${getLayoutValue()}\n` +
        `ç§Ÿé‡‘ï¼š${data.get('rent') || ''}\n` +
        `ç®¡ç†è²»ï¼š${data.get('fee') || ''}${data.get('fee_none') ? 'ï¼ˆç„¡ï¼‰' : ''}\n` +
        `åº•åƒ¹ï¼š${data.get('base') || ''}\n` +
        `å ±ç¨…ï¼š${data.get('tax') || ''}\n` +
        `ç§Ÿè£œï¼š${data.get('subsidy') || ''}\n` +
        `å…¥ç±ï¼š${data.get('register') || ''}\n` +
        `å¯µç‰©ï¼š${data.get('pet') || ''}\n` +
        `åƒåœ¾ä»£æ”¶ï¼š${data.get('garbage') || ''}${data.get('garbage') === 'æœ‰' && data.get('garbage_note') ? 'ï¼ˆ' + data.get('garbage_note') + 'ï¼‰' : ''}\n` +
        `åœè»Šä½ï¼š${data.get('parking') || ''}${data.get('parking') === 'æœ‰' && data.get('parking_note') ? 'ï¼ˆ' + data.get('parking_note') + 'ï¼‰' : ''}\n` +
        `å…¬è¨­ï¼š${data.get('public') || ''}\n` +
        `é›»è²»$/åº¦ï¼š${data.get('electric') || ''}\n` +
        `æ°´è²»ï¼š${data.get('water') || ''}\n` +
        `ç“¦æ–¯ï¼š${data.get('gas') || ''}\n` +
        `é„°è¿‘äº¤é€š(ç«™é»/åˆ†é˜)ï¼š${data.get('traffic') || ''}\n` +
        `å¸¶çœ‹æ–¹å¼ï¼š${data.get('show') || ''}\n` +
        `é™„åŠ è¨­å‚™ï¼š${data.get('equip') || ''}\n` +
        `æ³¨æ„äº‹é …(ç”Ÿæ´»æ©Ÿèƒ½ã€æ±æœç­‰è£œå……)ï¼š${data.get('note') || ''}\n` +
        `é–‹ç™¼ï¼š${data.get('dev') || ''}`;
      document.getElementById('output').value = output;
      autoGrow(document.getElementById('output'));
    }

    function copyText() {
      const output = document.getElementById('output');
      output.select();
      document.execCommand('copy');
      alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
    }

    function getTaiwanDate() {
      const today = new Date();
      const year = today.getFullYear() - 1911;
      const month = today.getMonth() + 1;
      const day = today.getDate();
      return `${year}/${month}/${day}`;
    }
    document.getElementById('date').value = getTaiwanDate();

    function adjustInputWidth(input) {
      let span = document.getElementById('width-tester');
      if (!span) {
        span = document.createElement('span');
        span.id = 'width-tester';
        span.style.visibility = 'hidden';
        span.style.position = 'absolute';
        span.style.whiteSpace = 'pre';
        span.style.font = window.getComputedStyle(input).font;
        document.body.appendChild(span);
      }
      span.textContent = input.value || input.placeholder || '';
      input.style.width = Math.max(120, span.offsetWidth + 20) + 'px';
    }
    document.querySelectorAll('.auto-grow').forEach(function(input) {
      input.addEventListener('input', function() {
        adjustInputWidth(this);
      });
      adjustInputWidth(input);
    });
    document.querySelectorAll('input[type="text"]').forEach(function(input) {
      input.addEventListener('input', function() {
        adjustInputWidth(this);
      });
    });

    // æ–°å¢ï¼šåœè»Šä½èˆ‡åƒåœ¾ä»£æ”¶å‚™è¨»æ¬„é¡¯ç¤ºæ§åˆ¶
    function toggleParkingNote(radio) {
      var note = document.getElementById('parking_note');
      if (radio.value === 'æœ‰' && radio.checked) {
        note.style.display = '';
        note.focus();
      } else {
        note.style.display = 'none';
        note.value = '';
      }
    }
    function toggleGarbageNote(radio) {
      var note = document.getElementById('garbage_note');
      if (radio.value === 'æœ‰' && radio.checked) {
        note.style.display = '';
        note.focus();
      } else {
        note.style.display = 'none';
        note.value = '';
      }
    }
  </script>
  <!-- é€™è£¡æ˜¯ Firebase + LINE ç™»å…¥ + ç™½åå–®é©—è­‰ + GA4äº‹ä»¶ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getAuth, signInWithPopup, OAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    // ä½ çš„ Firebase è¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyC5h8IedyM9oYt3y1VkoNkcYsAqq4yLRDk",
      authDomain: "kaiyan-real-estate.firebaseapp.com",
      projectId: "kaiyan-real-estate",
      storageBucket: "kaiyan-real-estate.appspot.com",
      messagingSenderId: "361523904560",
      appId: "1:361523904560:web:14f12a49a1b386b51dadf5",
      measurementId: "G-Z24BQWYZ9W"
    };

    // åˆå§‹åŒ–
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // LINE OIDC ç™»å…¥
    document.getElementById('lineLoginBtn').onclick = async function() {
      const provider = new OAuthProvider('oidc.line');
      try {
        await signInWithPopup(auth, provider);
        // ç™»å…¥æˆåŠŸå¾Œæœƒè‡ªå‹•è§¸ç™¼ onAuthStateChanged
      } catch (error) {
        alert('LINE ç™»å…¥å¤±æ•—ï¼š' + error.message);
      }
    };

    // ç›£è½ç™»å…¥ç‹€æ…‹
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // å–å¾— LINE userId
        const lineId = user.providerData[0].uid;
        // æŸ¥è©¢ Firestore çš„ whitelist
        const docRef = doc(db, "whitelist", lineId);
        const docSnap = await getDoc(docRef);
        let name = '';
        if (docSnap.exists()) {
          name = docSnap.data().name || '';
          // Google Analytics é€å‡ºç™»å…¥æˆåŠŸäº‹ä»¶
          if (typeof gtag === 'function') {
            gtag('event', 'login_success', {
              'user_id': lineId,
              'user_name': name
            });
          }
          // é€šéç™½åå–®ï¼Œé¡¯ç¤ºä¸»é 
          document.getElementById('pwbox').style.display = 'none';
          document.getElementById('maincontent').style.display = '';
          // åŠ æ°´å°
          let displayName = user.displayName || 'LINEç”¨æˆ¶';
          let now = new Date().toLocaleString();
          let watermark = document.createElement('div');
          watermark.innerText = `${displayName} | ${now}`;
          watermark.style.position = 'fixed';
          watermark.style.bottom = '10px';
          watermark.style.right = '10px';
          watermark.style.opacity = '0.5';
          watermark.style.fontSize = '13px';
          watermark.style.zIndex = '9999';
          document.body.appendChild(watermark);
        } else {
          // ä¸åœ¨ç™½åå–®ï¼Œç™»å‡º
          await signOut(auth);
          alert('æ­¤ LINE å¸³è™Ÿæœªæˆæ¬Šä½¿ç”¨');
        }
      } else {
        // å°šæœªç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥é 
        document.getElementById('pwbox').style.display = '';
        document.getElementById('maincontent').style.display = 'none';
      }
    });
  </script>
</body>
</html>
